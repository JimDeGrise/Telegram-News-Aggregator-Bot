from aiogram import Router
from aiogram.types import Message
from aiogram.filters import Command

router = Router()

HELP_TEXT = (
    "Бот агрегирует RSS независимых медиа, доступен полнотекстовый поиск (FTS5: AND OR NOT, знак минус -, фразы в \"\").\n\n"
    "Команды:\n"
    "/start — краткая справка\n"
    "/help — эта справка\n"
    "/ping — проверка работы бота\n"
    "/latest — последние N (фиксированно) новостей списком с пагинацией\n"
    "/news [N] — показать одну новость (по умолчанию 1-я). N — порядковый номер (1-based)\n"
    "/filter &lt;запрос&gt; |p — поиск (p — страница). Пример: /filter кризис AND экономика |2\n"
    "/source &lt;источник&gt; |p — новости одного источника. Пример: /source meduza |3\n"
    "/sources — список источников с количеством\n"
    "/stats — текущая статистика по источникам (основная БД)\n"
    "/arc_filter [source] [YYYY-MM] [limit] — просмотр архива. Без аргументов покажет подсказку и доступные месяцы.\n"
    "    Примеры: /arc_filter 2025-08 5 | /arc_filter reuters 2025-07 | /arc_filter reuters 5\n"
    "/src_stat — статистика по архиву (по месяцам и общий топ источников)\n"
    "/arc_months — список доступных архивных месяцев\n"
    "/archive_now — запуск ручной архивации (админ)\n"
    "/fetch — принудительный сбор (админ)\n\n"
    "Навигация:\n"
    "- В списках: « Пред / След » / Закрыть\n"
    "- В одиночной новости: ⏮ Перв. / « Пред / След » / Посл. ⏭ + ✖ Закрыть\n"
    "Особенности поиска: скобки ( ) не поддерживаются (FTS5). Фразы — в кавычках. Минус перед словом — исключение."
)


@router.message(Command("help"))
async def help_cmd(message: Message):
    """Обработчик команды /help - показывает справку по командам бота"""
    await message.answer(HELP_TEXT)